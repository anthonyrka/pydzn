<div {{ attrs|safe }}>
    {% if show_toolbar %}
    <div class="{{ d_toolbar }}">
      <div class="flex items-center gap-2">
        {# bulk/search/export buttons here; use d_btn / d_search_input #}
      </div>
      <form action="{{ search_action or '' }}" method="get"
            {% if search_action %}hx-get="{{ search_action }}" hx-target="#{{ id }}" hx-swap="outerHTML"{% endif %}>
        <input class="{{ d_search_input }}" type="search" name="q" value="{{ search_query }}" placeholder="Search…">
        <button class="{{ d_btn }}" type="submit">Search</button>
      </form>
    </div>
    {% endif %}
  
    <div class="overflow-auto">
      <table class="w-[100%]">
        <thead class="{{ d_thead }}">
          <tr>
            {% for col in columns %}
              <th class="{{ cell_pad_dzn }} {{ d_th }}">
                {# sorting link if enabled #}
                {% if col.sortable and sort_url %}
                  <a hx-get="{{ sort_url }}?sort={{ col.key }}&dir={{ 'desc' if sort_key==col.key and sort_dir=='asc' else 'asc' }}"
                     hx-target="#{{ id }}" hx-swap="outerHTML">
                    {{ col.label }}{% if sort_key==col.key %} {{ '▲' if sort_dir=='asc' else '▼' }}{% endif %}
                  </a>
                {% else %}
                  {{ col.label }}
                {% endif %}
              </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in rows %}
            <tr class="{{ d_tr }} {% if striped and loop.index0 % 2 == 1 %} {{ d_tr_alt }} {% endif %}">
              {% for col in columns %}
                {% set val = row.get(col.key, '') %}
                {% if primary_key and col.key == primary_key %}
                  <td class="{{ cell_pad_dzn }} {{ d_td }}">
                    <div class="{{ d_primary }}">{{ val|safe }}</div>
                    {% if row.get(actions_key) %}
                      <div class="{{ d_row_actions }}">{{ row.get(actions_key)|safe }}</div>
                    {% endif %}
                  </td>
                {% else %}
                  <td class="{{ cell_pad_dzn }} {{ d_td }}">{{ val|safe }}</td>
                {% endif %}
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  
    {% if total and pages > 1 %}
    <div class="{{ d_footer }}">
      <div>{{ total }} items</div>
      <div class="flex items-center gap-2">
        {% set last = pages %}
        {% set prev = page-1 if page>1 else 1 %}
        {% set next = page+1 if page<pages else pages %}
        <button class="{{ d_pager }}" hx-get="{{ sort_url }}?page=1&per_page={{ per_page }}&sort={{ sort_key }}&dir={{ sort_dir }}"  hx-target="#{{ id }}" hx-swap="outerHTML">«</button>
        <button class="{{ d_pager }}" hx-get="{{ sort_url }}?page={{ prev }}&per_page={{ per_page }}&sort={{ sort_key }}&dir={{ sort_dir }}" hx-target="#{{ id }}" hx-swap="outerHTML">‹</button>
        <span>Page {{ page }} of {{ pages }}</span>
        <button class="{{ d_pager }}" hx-get="{{ sort_url }}?page={{ next }}&per_page={{ per_page }}&sort={{ sort_key }}&dir={{ sort_dir }}" hx-target="#{{ id }}" hx-swap="outerHTML">›</button>
        <button class="{{ d_pager }}" hx-get="{{ sort_url }}?page={{ last }}&per_page={{ per_page }}&sort={{ sort_key }}&dir={{ sort_dir }}" hx-target="#{{ id }}" hx-swap="outerHTML">»</button>
      </div>
    </div>
    {% endif %}
  </div>
  